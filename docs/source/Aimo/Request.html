<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta content="Aimo PHP Framework API doc" name="description">
    <title>
                    Aimo PHP Framework API Documentation
            </title>
    <link rel="stylesheet" type="text/css" href="../../asset/static/prettify.css" />

<script src="../../asset/static/prettify.js"></script>
<script src="../../asset/api_definition.js"></script>


                        <link rel="stylesheet" type="text/css" href="../../asset/static/prettify.css" />
                    <link rel="stylesheet" type="text/css" href="../../asset/static/zephir-theme.css" />
            
    

                        <script src="../../asset/static/prettify.js"></script>
                                    <script src="../../asset/api_definition.js"></script>
                    <script src="../../asset/static/jquery.min.js"></script>
                    <script src="../../asset/static/zephir-doc.js"></script>
                <script>var ZepCurrentPath = '../../'</script>
    </head>
 <body onload="prettyPrint()">
        <div id="top-bar">
            <div id="top-left">
                                    Aimo PHP Framework Documentation <span class="version">v0.6.0</span>
                            </div>
            <div id="top-right">
            </div>
        </div>
        <div id="body">
            <div id="body-left">
                <div class="header-search">
                    <input class="search-box" placeholder="Search for a class or namespace " type="text" />
                    <div id="menu-wrapper">
                    </div>
                </div>
            </div>
            <div id="body-right">
                <div class="content">
                    
<div class="breadcrumb">
    
    <ul>
        
        <li><a href="../../index.html">Home</a></li>
        
                <li><a href="../../classes.html">Classes</a></li>
                <li><a href="../../class/Aimo/Request.html">Aimo\Request</a></li>
                <li><a >Source</a></li>
                
    </ul>
    
</div>
<div class="class-header source clearfix">
    
    <div class="access-buttons">
        <a class="zep-button" href="../../class/Aimo/Request.html">Class</a>

            </div>
    
    <div class="class-full-name">
        
        <span class="class-type">Class</span>
        
                <span class="namespace-piece">
            <a href="../../namespace/Aimo.html">Aimo</a>
        </span>
                <h1 class="class-name">Request</h1>
    </div>
    
</div>


<pre class="zephir-source-file prettyprint linenums">namespace Aimo;
class Request {
    private static instance;
    public params = [] {set,get};
    /**
     * 实例化Request对象
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->isPost());
     * var_dump($request->isPut());
     * var_dump($request->isDelete());
     * var_dump($request->isAjax());
     * var_dump($request->isMobile());
     * </code>
     *
     * @param boolean adv 是否进行高级模式获取（有可能被伪装）
     * @return string | long
     */
    public function __construct()
    {
    }

    /**
     * 单例模式
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request);
     * </code>
     *
     * @return Aimo\Request
     */
    public static function instance() -> <Request>
    {
        if self::instance === null {
            let self::instance = new self();
        }
        return self::instance;
    }

    /**
     * 判断请求类型模式
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->isPost());
     * </code>
     *
     * @return boolean
     */
    public function isPost()->boolean
    {
        return this->getMethod()==="POST";
    }

    /**
     * 判断请求类型模式
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->isPut());
     * </code>
     *
     * @return boolean
     */
    public function isPut()->boolean
    {
        return this->getMethod()==="PUT";
    }

    /**
     * 判断请求类型模式
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->isDelete());
     * </code>
     *
     * @return boolean
     */
    public function isDelete()->boolean
    {
        return this->getMethod()==="DELETE";
    }

    /**
     * 简单判断是否手机访问
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->isMobile());
     * </code>
     *
     * @return boolean
     */
    public function isMobile()->boolean
    {
        return !!preg_match("/android|iphone/i", _SERVER["HTTP_USER_AGENT"]);
    }

    /**
     * 判断是否Ajax请求
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->isAjax());
     * </code>
     *
     * @return boolean
     */
    public function isAjax()->boolean
    {
        return strtoupper(isset _SERVER["HTTP_X_REQUESTED_WITH"] ? _SERVER["HTTP_X_REQUESTED_WITH"] : "") === "XMLHTTPREQUEST";
    }

    /**
     * 获取GET数据
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->get('page',1,'int'));
     * var_dump($request->get('email','','email'));
     * var_dump($request->get('url','','url'));
     * var_dump($request->get('float',0.0,'float'));
     * var_dump($request->get('chars','','alpha'));//a-zA-Z
     * var_dump($request->get('aphnum','','alphanum'));//a-zA-Z0-9
     * var_dump($request->get('clothesSize','',function($value){
     *     return preg_replace('/[^MXL0-9]+/i','',$value);
     * }));
     * </code>
     *
     * @param string name 索引名
     * @param mixed def  默认值
     * @param mixed filter 过滤器
     * @return mixed
     */
    public function get(string! name,var def=null,var filter="text")
    {
        if !isset _GET[name] {
            return def;
        }
        if empty filter {
            return isset _GET[name] ? _GET[name] : def;
        }
        var method;
        let method = "f_".filter;
        if method_exists(this, method){
            return (typeof _GET[name] == "array") ?
                array_map([this, method], _GET[name]) :
                this->{method}(_GET[name]);
        } elseif function_exists(filter) {
            return (typeof _GET[name] == "array") ?
                array_map(filter, _GET[name]) : {filter}(_GET[name]);
        } elseif is_callable(filter) {
            return call_user_func(filter, _GET[name]);
        }
    }

    /**
     * 获取POST数据
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->post('page',1,'int'));
     * var_dump($request->post('email','','email'));
     * var_dump($request->post('url','','url'));
     * var_dump($request->post('float',0.0,'float'));
     * var_dump($request->post('chars','','alpha'));//a-zA-Z
     * var_dump($request->post('aphnum','','alphanum'));//a-zA-Z0-9
     * var_dump($request->post('clothesSize','',function($value){
     *     return preg_replace('/[^MXL0-9]+/i','',$value);
     * }));
     * </code>
     *
     * @param string name 索引名
     * @param mixed def  默认值
     * @param mixed filter 过滤器
     * @return mixed
     */
    public function post(string! name,var def=null,var filter="text")
    {
        if !isset _POST[name] {
            return def;
        }
        if empty filter {
            return isset _POST[name] ? _POST[name] : def;
        }
        var method;
        let method = "f_".filter;
        if method_exists(this, method){
            return (typeof _POST[name] == "array") ?
                array_map([this, method], _POST[name]) :
                this->{method}(_POST[name]);
        } elseif function_exists(filter) {
            return (typeof _POST[name] == "array") ?
                array_map(filter, _POST[name]) : {filter}(_POST[name]);
        } elseif is_callable(filter) {
            return call_user_func(filter, _POST[name]);
        }
    }

    /**
     * 获取REQUEST数据
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->request('page',1,'int'));
     * var_dump($request->request('email','','email'));
     * var_dump($request->request('url','','url'));
     * var_dump($request->request('float',0.0,'float'));
     * var_dump($request->request('chars','','alpha'));//a-zA-Z
     * var_dump($request->request('aphnum','','alphanum'));//a-zA-Z0-9
     * var_dump($request->request('clothesSize','',function($value){
     *     return preg_replace('/[^MXL0-9]+/i','',$value);
     * }));
     * </code>
     *
     * @param string name 索引名
     * @param mixed def  默认值
     * @param mixed filter 过滤器
     * @return mixed
     */
    public function request(string! name,var def=null,var filter="text")
    {
        if !isset _REQUEST[name] {
            return def;
        }
        if empty filter {
            return isset _REQUEST[name] ? _REQUEST[name] : def;
        }
        var method;
        let method = "f_".filter;
        if method_exists(this, method){
            return (typeof _REQUEST[name] == "array") ?
                array_map([this, method], _REQUEST[name]) :
                this->{method}(_REQUEST[name]);
        } elseif function_exists(filter) {
            return (typeof _REQUEST[name] == "array") ?
                array_map(filter, _REQUEST[name]) : {filter}(_REQUEST[name]);
        } elseif is_callable(filter) {
            return call_user_func(filter, _REQUEST[name]);
        }
    }

    /**
     * 获取REQUEST以及URL中的数据数据
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->param('page',1,'int'));
     * var_dump($request->param('email','','email'));
     * var_dump($request->param('url','','url'));
     * var_dump($request->param('float',0.0,'float'));
     * var_dump($request->param('chars','','alpha'));//a-zA-Z
     * var_dump($request->param('aphnum','','alphanum'));//a-zA-Z0-9
     * var_dump($request->param('clothesSize','',function($value){
     *     return preg_replace('/[^MXL0-9]+/i','',$value);
     * }));
     * </code>
     *
     * @param string name 索引名
     * @param mixed def  默认值
     * @param mixed filter 过滤器
     * @return mixed
     */
    public function param(string! name,var def=null,var filter="text")
    {
        var params;
        let params = Request::instance()->getParams();
        if !isset params[name] {
            return def;
        }
        if empty filter {
            return isset params[name] ? params[name] : def;
        }

        var method;
        let method = "f_".filter;
        if method_exists(this, method){
            return (typeof params[name] == "array") ?
                array_map([this, method], params[name]) :
                this->{method}(params[name]);
        } elseif function_exists(filter) {
            return (typeof params[name] == "array") ?
                array_map(filter, params[name]) : {filter}(params[name]);
        } elseif is_callable(filter) {
            return call_user_func(filter, params[name]);
        }
    }

    /**
     * 判断是否有上传的文件
     *
     * <code>
     * $request = Request::instance();
     * var_dump($request->hasFiles());
     * </code>
     *
     * @return boolean
     */
    public function hasFiles(string key="") -> boolean
    {
        if empty _FILES {
            return false;
        }
        if !isset _FILES[key] {
            return false;
        }
        if empty _FILES[key] {
            return false;
        }
        return true;
    }

    /**
     * 获取上传的文件
     *
     * <code>
     * $request = Request::instance();
     * if($request->hasFiles(){
     *     try {
     *        $request->savefile('formvar','./path/',2048000,'doc,docx,xls,xlsx');
     *     } catch (\Exception $e) {
     *        echo $e->getMessage();
     *     }
     * }
     * </code>
     *
     * @param string name 索引名
     * @param mixed def  默认值
     * @param mixed filter 过滤器
     * @return mixed
     */
    public function files()
    {

    }

    /**
     * Gets HTTP method which request has been made
     *
     * If the X-HTTP-Method-Override header is set, and if the method is a POST,
     * then it is used to determine the "real" intended HTTP method.
     *
     * The _method request parameter can also be used to determine the HTTP method,
     * but only if setHttpMethodParameterOverride(true) has been called.
     *
     * The method is always an uppercased string.
     */
    public final function getMethod() -> string
    {
        var overridedMethod, requestMethod;
        string returnMethod = "";

        if likely fetch requestMethod, _SERVER["REQUEST_METHOD"] {
            let returnMethod = strtoupper(requestMethod);
        } else {
            return "GET";
        }

        if "POST" === returnMethod {
            let overridedMethod = this->getHeader("X-HTTP-METHOD-OVERRIDE");
            if !empty overridedMethod {
                let returnMethod = strtoupper(overridedMethod);
            }
        }

        if !this->isValidHttpMethod(returnMethod) {
            return "GET";
        }

        return returnMethod;
    }

    /**
     * Checks if a method is a valid HTTP method
     */
    public function isValidHttpMethod(string method) -> boolean
    {
        switch strtoupper(method) {
            case "GET":
            case "POST":
            case "PUT":
            case "DELETE":
            case "HEAD":
            case "OPTIONS":
            case "PATCH":
            case "PURGE":
            case "TRACE":
            case "CONNECT":
                return true;
        }
        return false;
    }

    /**
     * Gets HTTP header from request data
     */
    public final function getHeader(string! header) -> string
    {
        var value, name;

        let name = strtoupper(strtr(header, "-", "_"));

        if fetch value, _SERVER[name] {
            return value;
        }

        if fetch value, _SERVER["HTTP_" . name] {
            return value;
        }

        return "";
    }


    /**
     * 获取客户端IP地址
     *
     * <code>
     * $ip = Request::instance()->ip();
     * var_dump($ip);
     * </code>
     *
     * @param boolean adv 是否进行高级模式获取（有可能被伪装）
     * @return string | long
     */
    public function ip(boolean adv = false) -> string
    {
        var arr, pos,ip;
        if adv {
            if isset _SERVER["HTTP_X_FORWARDED_FOR"]  {
                let arr = explode(",", _SERVER["HTTP_X_FORWARDED_FOR"]);
                let pos = array_search("unknown", arr);
                if false !== pos {
                    unset arr[pos] ;
                }
                let ip = trim(current(arr));
            } elseif isset _SERVER["HTTP_CLIENT_IP"]  {
                let ip = _SERVER["HTTP_CLIENT_IP"];
            } elseif isset _SERVER["REMOTE_ADDR"] {
                let ip = _SERVER["REMOTE_ADDR"];
            }
        } elseif isset _SERVER["REMOTE_ADDR"] {
            let ip = _SERVER["REMOTE_ADDR"];
        }
        return (string) ip;
    }

    /**
     * Data filters
     */
    public function f_text(var str)->string
    {
        return (string) filter_var(str, FILTER_SANITIZE_SPECIAL_CHARS);
    }

    public function f_int(var val)->long
    {
        return (long) filter_var(val, FILTER_SANITIZE_NUMBER_INT);
    }

    public function f_float(var val)->double
    {
        return (double) filter_var(val, FILTER_SANITIZE_NUMBER_FLOAT);
    }

    public function f_url(var val)->string
    {
        return (string) filter_var(val, FILTER_SANITIZE_URL);
    }

    public function f_email(var val)->string
    {
        return (string) filter_var(val, FILTER_SANITIZE_EMAIL);
    }

    public function f_alpha(var str)->string
    {
        return (string) preg_replace("/[^a-z]+/i", "", str);
    }

    public function f_alphanum(var str)->string
    {
        return (string) preg_replace("/[^a-z0-9]+/i", "", str);
    }

    public function f_number(var str)->string
    {
        return (string) preg_replace("/[^0-9\.\-\+]+/i", "", str);
    }

    public function f_array(var str)->array
    {
        return (array) str;
    }

    public function f_bool(var str)->boolean
    {
        return (boolean) str;
    }

}
</pre>                </div>
            </div>
        </div>
    </body>
</html>
